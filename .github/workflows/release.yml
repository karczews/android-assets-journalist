name: Release

on:
  push:
    branches: [ main ]

permissions:
  contents: write
  pull-requests: read

jobs:
  release:
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create release
        id: release
        uses: tomtom-international/commisery-action/bump@v2
        with:
          token: ${{ github.token }}
          create-release: true
          create-tag: true
        env:
          GRADLE_PUBLISH_KEY: ${{ secrets.GRADLE_PUBLISH_KEY }}
          GRADLE_PUBLISH_SECRET: ${{ secrets.GRADLE_PUBLISH_SECRET }}

      - name: Report release status
        run: |
          if [ -n "${{ steps.release.outputs.next-version }}" ]; then
            echo "✅ New version created: ${{ steps.release.outputs.next-version }}"
          else
            echo "ℹ️ No new version created - no version bump needed"
          fi
